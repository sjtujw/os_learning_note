# os_learning_note
learning note of operating system from PeKing University
## ch2 运行环境与运行机制
### CPU
* 处理器由运算器、控制器、寄存器及高速缓存组成；寄存器分为用户可见寄存器和控制和状态寄存器。
* 控制和状态寄存器：<br>
    - 程序计数器（PC：program counter）记录将要取出的指令的地址。
    - 指令寄存器（IR：Instruction Register）记录最近取出的指令。
    - 程序状态字（PSW：Program State Word）记录处理器的运行状态如条件码、模式、控制位等。
* 处理器的状态：两种、三种、四种？
* 操作系统需要两种CPU状态：用户态（用户程序）和内核态（操作系统程序）。通过设置PSW关键字来区别。
* 指令分为特权指令、非特权指令。特权：启动I/O，内存清零，修改程序状态字，设置时钟，允许/禁止中断，停机。
* CPU状态切换：
    - 用户态 ——> 内核态：唯一途径是引入中断、异常、陷入机制（陷入指令又叫访管指令，给用户的接口，用来调用操作系统功能或服务）
    - 内核态 ——> 用户态：设置程序状态字PSW
### 中断/异常
* 事件分为：
    - 中断（外中断）：I/O中断、时钟中断、硬件故障
    - 异常（内中断）：系统调用、页故障/错误、保护性异常、断点指令、其他程序性异常
* 中断处理流程：硬件响应中断，软件处理中断
* 中断向量：一个内存单元，存放中断处理程序入口地址和程序运行时所需的处理机状态字。
![中断向量表](https://github.com/sjtujw/os_learning_note/raw/master/img/Interrupt_list.jpg)
* 中断响应示意图
![中断响应示意图](https://github.com/sjtujw/os_learning_note/raw/master/img/Interrupt_response.jpg)
* 举例：X86处理器（待补充）
### 系统调用机制
1. 定义：用户在编程时可以调用的操作系统功能
2. 描述：操作系统给编程人员的唯一接口，使CPU状态从用户态陷入内核态；每个操作系统提供几百种系统调用（进程控制、进程通信、文件使用、目录操作、设备管理、信息维护等）
